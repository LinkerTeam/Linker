<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.linker.mapper.memberMapper">

<!-- 팀에 속하면서 인증상태가 1인 멤버만 출력 : 멤버리스트 출력 시 사용-->
     <select id="TeamHasUsers" resultType="MemberVO">
        SELECT thu.t_id, thu.u_id, u.nickname,
		thu.auth, u.email, thu.status
		FROM user AS u
		JOIN team_has_user AS thu ON u.id=thu.u_id
		WHERE thu.t_id IN (
		SELECT t_id
		FROM team_has_user
		WHERE u_id= #{u_id} AND status=1
		)
        ;
     </select>

     <!-- email과 팀 아이디로 user가 속한 특정 팀의 정보를 가져옴/ 멤버를 초대할 때 이메일을 입력하고
     	  버튼을 누르면 Query 실행-->
 	 <select id="userHasTeamEmail" resultType="MemberVO">
         SELECT thu.u_id, nickname,
		t.name, auth, thu.t_id, email
		FROM user AS u
		JOIN team_has_user AS thu ON u.id=thu.u_id
		JOIN team AS t ON t.id=thu.t_id
		WHERE email= #{email} and t_id = #{t_id}
        ;
     </select>  
     
     <!-- email을 이용해서 userID정보를 가져옴-->
 	 <select id="userEmail" resultType="MemberVO">
        SELECT id as u_id
		FROM user as u
		WHERE email= #{email}
        ;
     </select> 
      
	<!-- member 초대해서 생성/ auth defualt 값: 2, status default 값: 0 -->
	<insert id="createMember">
		INSERT INTO team_has_user(t_id, u_id)
		VALUES (#{t_id},#{u_id})
		;
	</insert>

	<!-- 팀을 직접 만들어서 member 생성 -->
	<insert id="connectTeamMember">
		INSERT INTO team_has_user(t_id, u_id, auth, status)
		VALUES (#{t_id},#{u_id},0, 1)
		;
	</insert>
	
	<!-- member 추방/그 팀에서 권한이 0 또는 1인 user만 가능 -->
	<delete id="deleteMember">
		DELETE FROM team_has_user
		WHERE u_id=#{u_id}
		AND t_id=#{t_id}
		;
	</delete>

	<!-- member 수정(권한수정)/그 팀에서 권한이 0 또는 1인 user만 가능-->
	<update id="modifyMemberAuth">
		UPDATE team_has_user
		SET auth = #{auth}
		WHERE u_id=#{u_id}
		AND t_id=#{t_id}
		;
	</update>
	
	<!-- member 인증 상태코드 변경. default값은 0. 인증완료는 1. -->
	<update id="modifyMemberStatus">
		UPDATE team_has_user
		SET status = 1
		WHERE u_id=#{u_id}
		AND t_id=#{t_id}
		;
	</update>

</mapper>